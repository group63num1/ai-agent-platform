# 用户注册功能说明

## 功能概述

用户注册时，必须提供可用的手机号或邮箱号，并且能够接收验证码。只有验证码验证通过后才能完成注册。

## API接口

### 1. 发送邮箱注册验证码

**接口地址**: `POST /api/v1/verification/email/register`

**请求参数**:
- `email` (必填): 邮箱地址

**响应示例**:
```json
{
  "code": 0,
  "message": "验证码已发送到邮箱",
  "data": null
}
```

### 2. 发送手机号注册验证码

**接口地址**: `POST /api/v1/verification/sms/register`

**请求参数**:
- `phone` (必填): 手机号

**响应示例**:
```json
{
  "code": 0,
  "message": "验证码已发送到手机",
  "data": null
}
```

### 3. 用户注册

**接口地址**: `POST /api/v1/auth/register`

**请求参数**:
```json
{
  "username": "testuser",
  "email": "test@example.com",  // 可选，但必须提供邮箱或手机号
  "phone": "13800138000",        // 可选，但必须提供邮箱或手机号
  "verificationCode": "123456",  // 必填，6位数字验证码
  "password": "password123",
  "nickname": "测试用户"          // 可选
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "操作成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "phone": "13800138000",
    "nickname": "测试用户",
    "status": 1,
    "emailVerified": 1,
    "phoneVerified": 1
  }
}
```

## 注册流程

1. **获取验证码**
   - 用户输入邮箱或手机号
   - 调用发送验证码接口
   - 系统发送验证码到用户邮箱或手机

2. **提交注册信息**
   - 用户填写用户名、密码等信息
   - 输入收到的验证码
   - 提交注册请求

3. **验证和注册**
   - 系统验证验证码是否正确
   - 验证码验证通过后，创建用户账户
   - 自动标记邮箱或手机号为已验证状态

## 验证规则

1. **邮箱和手机号**
   - 必须提供邮箱或手机号至少一个
   - 邮箱格式必须正确
   - 手机号必须是11位数字，以1开头

2. **验证码**
   - 验证码为6位数字
   - 验证码有效期为5分钟
   - 验证码使用后立即失效
   - 1分钟内最多发送3次验证码

3. **用户名和密码**
   - 用户名长度3-50个字符
   - 密码长度6-20个字符
   - 密码必须包含字母和数字

## 错误处理

### 验证码相关错误
- `验证码错误或已过期`: 验证码不正确或已过期
- `验证码发送过于频繁，请稍后再试`: 发送频率过高
- `验证码发送失败，请稍后重试`: 发送失败

### 注册相关错误
- `必须提供邮箱或手机号`: 未提供邮箱或手机号
- `用户名已存在`: 用户名已被使用
- `邮箱已被注册`: 邮箱已被注册
- `手机号已被注册`: 手机号已被注册
- `密码必须包含字母和数字，且长度至少6位`: 密码不符合要求

## 注意事项

1. **验证码有效期**: 验证码有效期为5分钟，过期后需要重新获取
2. **发送频率限制**: 1分钟内最多发送3次验证码，防止恶意刷验证码
3. **验证码使用**: 验证码使用后立即失效，不能重复使用
4. **邮箱/手机验证**: 注册成功后，使用的邮箱或手机号会自动标记为已验证状态

## 示例代码

### 邮箱注册示例

```javascript
// 1. 发送验证码
fetch('/api/v1/verification/email/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
  },
  body: 'email=test@example.com'
})
.then(response => response.json())
.then(data => {
  console.log('验证码已发送');
});

// 2. 注册
fetch('/api/v1/auth/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    username: 'testuser',
    email: 'test@example.com',
    verificationCode: '123456',
    password: 'password123',
    nickname: '测试用户'
  })
})
.then(response => response.json())
.then(data => {
  console.log('注册成功', data);
});
```

### 手机号注册示例

```javascript
// 1. 发送验证码
fetch('/api/v1/verification/sms/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
  },
  body: 'phone=13800138000'
})
.then(response => response.json())
.then(data => {
  console.log('验证码已发送');
});

// 2. 注册
fetch('/api/v1/auth/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    username: 'testuser',
    phone: '13800138000',
    verificationCode: '123456',
    password: 'password123',
    nickname: '测试用户'
  })
})
.then(response => response.json())
.then(data => {
  console.log('注册成功', data);
});
```

