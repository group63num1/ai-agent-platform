# AI Agent API æ¥å£è¯´æ˜æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [æ¦‚è¿°](#æ¦‚è¿°)
- [åŸºç¡€ä¿¡æ¯](#åŸºç¡€ä¿¡æ¯)
- [è®¤è¯](#è®¤è¯)
- [æ ¸å¿ƒæ¥å£](#æ ¸å¿ƒæ¥å£)
  - [1. Chat æ¥å£](#1-chat-æ¥å£)
  - [2. Tool æ¥å£](#2-tool-æ¥å£)
  - [3. Knowledge Base æ¥å£](#3-knowledge-base-æ¥å£)
- [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
- [ç¤ºä¾‹](#ç¤ºä¾‹)

---

## æ¦‚è¿°

AI Agent API æ˜¯ä¸€ä¸ªåŸºäº FastAPI çš„æœåŠ¡ï¼Œæä¾›ï¼š
- **å¯¹è¯åŠŸèƒ½**ï¼šæ”¯æŒå¤šè½®å¯¹è¯ã€å·¥å…·è°ƒç”¨ã€RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰
- **å·¥å…·ç®¡ç†**ï¼šæ”¯æŒåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤å·¥å…·
- **çŸ¥è¯†åº“ç®¡ç†**ï¼šæ”¯æŒåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤çŸ¥è¯†åº“

**æ€»å…± 9 ä¸ªæ ¸å¿ƒæ¥å£**ï¼š
- 1 ä¸ª Chat æ¥å£
- 3 ä¸ª Tool æ¥å£ï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰
- 5 ä¸ª Knowledge Base æ¥å£ï¼ˆåˆ›å»ºã€åˆ—è¡¨ã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰

---

## åŸºç¡€ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|-----|-----|
| æœåŠ¡å™¨åœ°å€ | `http://127.0.0.1:8000` |
| API å‰ç¼€ | `/api` |
| è¿”å›æ ¼å¼ | JSON / Server-Sent Events (SSE) |
| å­—ç¬¦ç¼–ç  | UTF-8 |

---

## è®¤è¯

å½“å‰ç‰ˆæœ¬**ä¸éœ€è¦è®¤è¯**ï¼Œæ‰€æœ‰æ¥å£éƒ½å¯ä»¥ç›´æ¥è®¿é—®ã€‚

å¦‚éœ€è®¤è¯ï¼Œå¯åœ¨åç»­ç‰ˆæœ¬ä¸­é›†æˆ JWT Token æˆ– API Keyã€‚

---

# æ ¸å¿ƒæ¥å£

## 1. Chat æ¥å£

### 1.1 æµå¼å¯¹è¯

#### ç«¯ç‚¹
```
POST /api/chat
```

#### è¯´æ˜
æ ¸å¿ƒå¯¹è¯æ¥å£ï¼Œæ”¯æŒï¼š
- âœ… å¤šè½®å¯¹è¯ï¼ˆé€šè¿‡ `session_id` ç®¡ç†ä¼šè¯ï¼‰
- âœ… å·¥å…·è°ƒç”¨ï¼ˆé€šè¿‡ `tools` å‚æ•°æŒ‡å®šå¯ç”¨å·¥å…·ï¼‰
- âœ… RAG æ£€ç´¢ï¼ˆé€šè¿‡ `knowledge_bases` å‚æ•°æŒ‡å®šçŸ¥è¯†åº“ï¼‰
- âœ… è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼ˆé€šè¿‡ `system_prompt` å‚æ•°ï¼‰
- âœ… æµå¼è¾“å‡ºï¼ˆServer-Sent Events æ ¼å¼ï¼‰

#### è¯·æ±‚å¤´
```
Content-Type: application/json
```

#### è¯·æ±‚ä½“ (JSON)

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹ |
|-----|-----|------|------|------|
| `message` | string | âœ… | ç”¨æˆ·é—®é¢˜ | `"ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ?"` |
| `model_id` | string | âœ… | æ¨¡å‹ID | `"qwen3-max"` |
| `session_id` | string | âŒ | ä¼šè¯IDï¼Œç”¨äºå¤šè½®å¯¹è¯ | `"session_123"` |
| `tools` | array | âŒ | å¯ç”¨å·¥å…·IDåˆ—è¡¨ï¼Œç©ºæ•°ç»„è¡¨ç¤ºä¸ä½¿ç”¨å·¥å…· | `["tool1", "tool2"]` |
| `knowledge_bases` | array | âŒ | çŸ¥è¯†åº“IDåˆ—è¡¨ï¼Œç©ºæ•°ç»„è¡¨ç¤ºä¸ä½¿ç”¨RAG | `["kb_id_1"]` |
| `system_prompt` | string | âŒ | ç³»ç»Ÿæç¤ºè¯ | `"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„AIåŠ©æ‰‹"` |
| `history` | array | âŒ | å¯¹è¯å†å²ï¼Œæ ¼å¼: `[{"role": "user", "content": "..."}, ...]` | - |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST http://127.0.0.1:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æœºå™¨å­¦ä¹ æ˜¯ä»€ä¹ˆ?",
    "model_id": "qwen3-max",
    "session_id": "user_session_1",
    "knowledge_bases": ["kb_id_1"],
    "tools": [],
    "history": []
  }' \
  --no-buffer
```

#### å“åº”æ ¼å¼ (Server-Sent Events)

æµå¼å“åº”ï¼Œæ¯ä¸ªäº‹ä»¶åŒ…å«ä¸€ä¸ª JSON å¯¹è±¡ï¼š

```
data: {"content": "æœºå™¨å­¦ä¹ æ˜¯", "done": false}
data: {"content": "ä¸€ç§ä½¿", "done": false}
data: {"content": "è®¡ç®—æœºèƒ½å¤Ÿ", "done": false}
...
data: [DONE]
```

**å“åº”å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|-----|------|
| `content` | string | å“åº”å†…å®¹ç‰‡æ®µ |
| `done` | boolean | æ˜¯å¦å®Œæˆï¼ˆé€šå¸¸æœ€åä¸€æ¡ä¸º trueï¼‰|
| `error` | string | é”™è¯¯ä¿¡æ¯ï¼ˆä»…åœ¨å‡ºé”™æ—¶åŒ…å«ï¼‰|
| `success` | boolean | è¯·æ±‚æ˜¯å¦æˆåŠŸ |

#### å“åº”ç¤ºä¾‹

```json
{"content": "æœºå™¨å­¦ä¹ æ˜¯", "done": false}
{"content": "äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªé‡è¦åˆ†æ”¯", "done": false}
{"content": "ï¼Œå®ƒé€šè¿‡...", "done": true}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸï¼Œè¿”å›æµå¼å“åº” |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

## 2. Tool æ¥å£

### 2.1 åˆ›å»ºå·¥å…·

#### ç«¯ç‚¹
```
POST /api/tools
```

#### è¯´æ˜
é€šè¿‡ä¸Šä¼  OpenAPI JSON æ–‡ä»¶åˆ›å»ºå·¥å…·ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨è§£æ OpenAPI å®šä¹‰ï¼Œä¸ºæ¯ä¸ªç«¯ç‚¹åˆ›å»ºä¸€ä¸ªå·¥å…·ã€‚

#### è¯·æ±‚å¤´
```
Content-Type: application/json
```

#### è¯·æ±‚ä½“ (JSON)

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|-----|------|------|
| `user_id` | string | âœ… | ç”¨æˆ·IDï¼ˆç”¨äºå·¥å…·éš”ç¦»ï¼‰ |
| `openapi` | object | âœ… | OpenAPI JSON å¯¹è±¡ï¼ˆå‚è€ƒ [OpenAPI 3.0 è§„èŒƒ](https://spec.openapis.org/oas/v3.0.0)ï¼‰|

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST http://127.0.0.1:8000/api/tools \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_123",
    "openapi": {
      "openapi": "3.0.0",
      "info": {
        "title": "Weather API",
        "version": "1.0.0"
      },
      "paths": {
        "/weather": {
          "get": {
            "operationId": "getWeatherInfo",
            "summary": "Get weather information",
            "parameters": [
              {
                "name": "city",
                "in": "query",
                "required": true,
                "schema": {"type": "string"}
              }
            ],
            "responses": {
              "200": {
                "description": "Weather data"
              }
            }
          }
        }
      }
    }
  }'
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "tools": [
    {
      "tool_id": "user_123_getWeatherInfo",
      "name": "Get weather information"
    }
  ],
  "message": "æˆåŠŸåˆ›å»º 1 ä¸ªå·¥å…·"
}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | å·¥å…·åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

### 2.2 æ›´æ–°å·¥å…·

#### ç«¯ç‚¹
```
PUT /api/tools/{tool_id}
```

#### è¯´æ˜
æ›´æ–°å·¥å…·çš„é…ç½®ï¼Œå¦‚å‚æ•°å€¼ã€ç”¨æˆ·è®¾ç½®ç­‰ã€‚

#### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|-----|------|------|
| `tool_id` | string | âœ… | å·¥å…·ID |

#### è¯·æ±‚å¤´
```
Content-Type: application/json
```

#### è¯·æ±‚ä½“ (JSON)

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|-----|------|------|
| `name` | string | âŒ | æ–°çš„å·¥å…·åç§° |
| `purpose` | string | âŒ | æ–°çš„å·¥å…·ç”¨é€” |
| `version` | string | âŒ | æ–°çš„ç‰ˆæœ¬å· |
| `call_method` | string | âŒ | è°ƒç”¨æ–¹æ³• |
| `parameters` | array | âŒ | å‚æ•°å®šä¹‰ |
| `user_settings` | object | âŒ | ç”¨æˆ·è®¾ç½® |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X PUT http://127.0.0.1:8000/api/tools/user_123_getWeatherInfo \
  -H "Content-Type: application/json" \
  -d '{
    "purpose": "è·å–å®æ—¶å¤©æ°”ä¿¡æ¯",
    "user_settings": {
      "api_key": "your_api_key"
    }
  }'
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "å·¥å…·æ›´æ–°æˆåŠŸ"
}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | å·¥å…·æ›´æ–°æˆåŠŸ |
| 404 | å·¥å…·ä¸å­˜åœ¨ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

### 2.3 åˆ é™¤å·¥å…·

#### ç«¯ç‚¹
```
DELETE /api/tools/{tool_id}
```

#### è¯´æ˜
åˆ é™¤æŒ‡å®šçš„å·¥å…·ã€‚

#### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|-----|------|------|
| `tool_id` | string | âœ… | å·¥å…·ID |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X DELETE http://127.0.0.1:8000/api/tools/user_123_getWeatherInfo
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "å·¥å…·åˆ é™¤æˆåŠŸ"
}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | å·¥å…·åˆ é™¤æˆåŠŸ |
| 404 | å·¥å…·ä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

## 3. Knowledge Base æ¥å£

### 3.1 åˆ›å»ºçŸ¥è¯†åº“

#### ç«¯ç‚¹
```
POST /api/knowledge-bases
```

#### è¯´æ˜
åˆ›å»ºä¸€ä¸ªæ–°çš„çŸ¥è¯†åº“ï¼Œæ”¯æŒä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨è¿›è¡Œåˆ†å—ï¼ˆchunkingï¼‰å’Œå‘é‡åŒ–ã€‚

#### è¯·æ±‚å¤´
```
Content-Type: application/json
```

#### è¯·æ±‚ä½“ (JSON)

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|-----|------|------|--------|
| `user_id` | string | âœ… | ç”¨æˆ·ID | - |
| `name` | string | âœ… | çŸ¥è¯†åº“åç§° | - |
| `files` | array | âœ… | æ–‡ä»¶åˆ—è¡¨ï¼Œæ¯ä¸ªæ–‡ä»¶åŒ…å« `filename` å’Œ `content` | - |
| `description` | string | âŒ | çŸ¥è¯†åº“æè¿° | "" |
| `chunking_method` | string | âŒ | åˆ†å—æ–¹å¼: `recursive`ã€`fixed`ã€`semantic` | `"recursive"` |
| `chunk_size` | integer | âŒ | å•ä¸ªå—çš„å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰ | `1000` |
| `chunk_overlap` | integer | âŒ | å—ä¹‹é—´çš„é‡å å­—ç¬¦æ•° | `200` |
| `enabled` | boolean | âŒ | æ˜¯å¦å¯ç”¨çŸ¥è¯†åº“ | `true` |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST http://127.0.0.1:8000/api/knowledge-bases \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test_user",
    "name": "æœºå™¨å­¦ä¹ å…¥é—¨",
    "description": "å…³äºæœºå™¨å­¦ä¹ çš„åŸºç¡€çŸ¥è¯†",
    "files": [
      {
        "filename": "ml_basics.txt",
        "content": "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯..."
      },
      {
        "filename": "ml_algorithms.txt",
        "content": "å¸¸è§çš„æœºå™¨å­¦ä¹ ç®—æ³•åŒ…æ‹¬..."
      }
    ],
    "chunk_size": 500,
    "chunk_overlap": 50,
    "chunking_method": "recursive",
    "enabled": true
  }'
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "kb_id": "be573f5d7e5f8cd6",
  "name": "æœºå™¨å­¦ä¹ å…¥é—¨",
  "user_id": "test_user",
  "description": "å…³äºæœºå™¨å­¦ä¹ çš„åŸºç¡€çŸ¥è¯†",
  "total_chunks": 12,
  "milvus_collection": "kb_be573f5d7e5f8cd6",
  "created_at": "2025-12-06T10:00:00",
  "enabled": true
}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | çŸ¥è¯†åº“åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

### 3.2 æŸ¥è¯¢çŸ¥è¯†åº“

#### ç«¯ç‚¹
```
POST /api/knowledge-bases/{kb_id}/query
```

#### è¯´æ˜
æŸ¥è¯¢ç‰¹å®šçŸ¥è¯†åº“çš„å†…å®¹ï¼Œæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
1. **ç›¸ä¼¼åº¦æŸ¥è¯¢**ï¼šæä¾› `query_text` æ—¶ï¼Œä»å‰ 5 ä¸ªç»“æœä¸­ç­›é€‰ç›¸ä¼¼åº¦ >= threshold çš„å†…å®¹
2. **ç›´æ¥æŸ¥è¯¢**ï¼šä¸æä¾› `query_text` æ—¶ï¼Œè¿”å›è¯¥çŸ¥è¯†åº“çš„å‰ 20 ä¸ªå—

#### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|-----|------|------|
| `kb_id` | string | âœ… | çŸ¥è¯†åº“ID |

#### è¯·æ±‚å¤´
```
Content-Type: application/json
```

#### è¯·æ±‚ä½“ (JSON)

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|-----|------|------|--------|
| `query_text` | string | âŒ | æŸ¥è¯¢æ–‡æœ¬ï¼Œä¸ºç©ºæ—¶è¿”å›å‰ N ä¸ªå— | - |
| `similarity_threshold` | float | âŒ | ç›¸ä¼¼åº¦é˜ˆå€¼ (0.0-1.0)ï¼Œä»…åœ¨æœ‰ query_text æ—¶ç”Ÿæ•ˆ | 0.0 |
| `limit` | integer | âŒ | è¿”å›çš„æœ€å¤§å—æ•° | 20 |

#### è¯·æ±‚ç¤ºä¾‹

**æ¨¡å¼ 1ï¼šç›¸ä¼¼åº¦æŸ¥è¯¢**

```bash
curl -X POST http://127.0.0.1:8000/api/knowledge-bases/be573f5d7e5f8cd6/query \
  -H "Content-Type: application/json" \
  -d '{
    "query_text": "ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ?",
    "similarity_threshold": 0.5,
    "limit": 5
  }'
```

**æ¨¡å¼ 2ï¼šç›´æ¥æŸ¥è¯¢ï¼ˆå‰ N ä¸ªå—ï¼‰**

```bash
curl -X POST http://127.0.0.1:8000/api/knowledge-bases/be573f5d7e5f8cd6/query \
  -H "Content-Type: application/json" \
  -d '{
    "limit": 20
  }'
```

#### å“åº”ç¤ºä¾‹

**ç›¸ä¼¼åº¦æŸ¥è¯¢å“åº”**ï¼š

```json
{
  "success": true,
  "count": 3,
  "query_text": "ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ?",
  "similarity_threshold": 0.5,
  "kb_id": "be573f5d7e5f8cd6",
  "results": [
    {
      "id": "chunk_1",
      "text": "ç¥ç»ç½‘ç»œæ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ç§ç®—æ³•...",
      "source": "ml_basics.txt",
      "timestamp": "2025-12-06T10:00:00",
      "similarity": 0.87
    },
    {
      "id": "chunk_2",
      "text": "æ·±åº¦ç¥ç»ç½‘ç»œç”±å¤šå±‚ç¥ç»å…ƒç»„æˆ...",
      "source": "ml_algorithms.txt",
      "timestamp": "2025-12-06T10:00:00",
      "similarity": 0.72
    }
  ]
}
```

**ç›´æ¥æŸ¥è¯¢å“åº”**ï¼š

```json
{
  "success": true,
  "count": 5,
  "query_text": null,
  "kb_id": "be573f5d7e5f8cd6",
  "results": [
    {
      "id": "chunk_1",
      "text": "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªé‡è¦åˆ†æ”¯...",
      "source": "ml_basics.txt",
      "timestamp": "2025-12-06T10:00:00"
    }
  ]
}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | æŸ¥è¯¢æˆåŠŸ |
| 404 | çŸ¥è¯†åº“ä¸å­˜åœ¨ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

### 3.3 åˆ—è¡¨çŸ¥è¯†åº“

#### ç«¯ç‚¹
```
GET /api/knowledge-bases
```

#### è¯´æ˜
è·å–çŸ¥è¯†åº“åˆ—è¡¨ï¼ˆå·²åˆ é™¤ï¼Œè¯·ä½¿ç”¨åˆ›å»ºå’Œç®¡ç†æ¥å£ï¼‰

**âš ï¸ å·²åºŸå¼ƒ**ï¼šæ­¤æ¥å£å·²åˆ é™¤ã€‚è¯·ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ç®¡ç†çŸ¥è¯†åº“ï¼š
- åˆ›å»ºçŸ¥è¯†åº“ï¼š`POST /api/knowledge-bases`
- æŸ¥è¯¢çŸ¥è¯†åº“ï¼š`POST /api/knowledge-bases/{kb_id}/query`
- æ›´æ–°çŸ¥è¯†åº“ï¼š`PUT /api/knowledge-bases/{kb_id}`
- åˆ é™¤çŸ¥è¯†åº“ï¼š`DELETE /api/knowledge-bases/{kb_id}`

---

### 3.3 æ›´æ–°çŸ¥è¯†åº“

#### ç«¯ç‚¹
```
PUT /api/knowledge-bases/{kb_id}
```

#### è¯´æ˜
æ›´æ–°çŸ¥è¯†åº“ä¿¡æ¯ã€‚å¦‚æœæ›´æ–°äº†æ–‡ä»¶ã€åˆ†å—æ–¹å¼æˆ–åˆ†å—å‚æ•°ï¼Œç³»ç»Ÿä¼šé‡æ–°å‘é‡åŒ–æ•´ä¸ªçŸ¥è¯†åº“ã€‚

#### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|-----|------|------|
| `kb_id` | string | âœ… | çŸ¥è¯†åº“ID |

#### è¯·æ±‚å¤´
```
Content-Type: application/json
```

#### è¯·æ±‚ä½“ (JSON)

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|-----|------|------|
| `name` | string | âŒ | æ–°çš„çŸ¥è¯†åº“åç§° |
| `description` | string | âŒ | æ–°çš„çŸ¥è¯†åº“æè¿° |
| `files` | array | âŒ | æ–°çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆæ›´æ–°æ—¶ä¼šé‡æ–°å‘é‡åŒ–ï¼‰ |
| `chunk_size` | integer | âŒ | æ–°çš„å—å¤§å°ï¼ˆæ›´æ–°æ—¶ä¼šé‡æ–°å‘é‡åŒ–ï¼‰ |
| `chunk_overlap` | integer | âŒ | æ–°çš„å—é‡å ï¼ˆæ›´æ–°æ—¶ä¼šé‡æ–°å‘é‡åŒ–ï¼‰ |
| `chunking_method` | string | âŒ | æ–°çš„åˆ†å—æ–¹å¼ï¼ˆæ›´æ–°æ—¶ä¼šé‡æ–°å‘é‡åŒ–ï¼‰ |
| `enabled` | boolean | âŒ | æ˜¯å¦å¯ç”¨ |

#### è¯·æ±‚ç¤ºä¾‹

**åªæ›´æ–°å…ƒæ•°æ®**ï¼š

```bash
curl -X PUT http://127.0.0.1:8000/api/knowledge-bases/be573f5d7e5f8cd6 \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æœºå™¨å­¦ä¹ å®Œå…¨æŒ‡å—",
    "description": "æ›´æ–°åçš„æè¿°",
    "enabled": true
  }'
```

**æ›´æ–°æ–‡ä»¶å¹¶é‡æ–°å‘é‡åŒ–**ï¼š

```bash
curl -X PUT http://127.0.0.1:8000/api/knowledge-bases/be573f5d7e5f8cd6 \
  -H "Content-Type: application/json" \
  -d '{
    "files": [
      {
        "filename": "new_file.txt",
        "content": "æ–°çš„å†…å®¹..."
      }
    ],
    "chunk_size": 300
  }'
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "çŸ¥è¯†åº“æ›´æ–°æˆåŠŸ",
  "kb_id": "be573f5d7e5f8cd6"
}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | çŸ¥è¯†åº“æ›´æ–°æˆåŠŸ |
| 404 | çŸ¥è¯†åº“ä¸å­˜åœ¨ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

### 3.4 åˆ é™¤çŸ¥è¯†åº“

#### ç«¯ç‚¹
```
DELETE /api/knowledge-bases/{kb_id}
```

#### è¯´æ˜
åˆ é™¤çŸ¥è¯†åº“ï¼ŒåŒæ—¶åˆ é™¤å‘é‡æ•°æ®åº“ï¼ˆMilvus é›†åˆï¼‰å’Œå…³ç³»æ•°æ®åº“è®°å½•ã€‚

#### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|-----|------|------|
| `kb_id` | string | âœ… | çŸ¥è¯†åº“ID |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X DELETE http://127.0.0.1:8000/api/knowledge-bases/be573f5d7e5f8cd6
```

#### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "çŸ¥è¯†åº“åˆ é™¤æˆåŠŸ"
}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | çŸ¥è¯†åº“åˆ é™¤æˆåŠŸ |
| 404 | çŸ¥è¯†åº“ä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

## é”™è¯¯å¤„ç†

æ‰€æœ‰ API é”™è¯¯å“åº”éƒ½éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š

```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

### å¸¸è§é”™è¯¯

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|-----|--------|
| çŸ¥è¯†åº“ä¸å­˜åœ¨ | æŒ‡å®šçš„ KB_ID åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ | æ£€æŸ¥ KB_ID æ˜¯å¦æ­£ç¡®ï¼Œä½¿ç”¨åˆ—è¡¨æ¥å£æŸ¥çœ‹æ‰€æœ‰çŸ¥è¯†åº“ |
| å·¥å…·ä¸å­˜åœ¨ | æŒ‡å®šçš„å·¥å…·ä¸å­˜åœ¨ | å…ˆåˆ›å»ºå·¥å…·ï¼Œæˆ–æ£€æŸ¥å·¥å…· ID æ˜¯å¦æ­£ç¡® |
| ç¼ºå°‘å¿…éœ€å­—æ®µ | è¯·æ±‚ä½“ä¸­ç¼ºå°‘å¿…éœ€çš„å­—æ®µ | å‚è€ƒæ¥å£è¯´æ˜ï¼Œè¡¥å……æ‰€æœ‰å¿…éœ€å­—æ®µ |
| æœåŠ¡å™¨é”™è¯¯ | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œæ’æŸ¥é—®é¢˜ |

---

## ç¤ºä¾‹

### å®Œæ•´å·¥ä½œæµç¤ºä¾‹

#### 1. åˆ›å»ºçŸ¥è¯†åº“

```bash
curl -X POST http://127.0.0.1:8000/api/knowledge-bases \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "demo_user",
    "name": "AI å­¦ä¹ èµ„æ–™",
    "files": [
      {
        "filename": "ai_basics.txt",
        "content": "äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯..."
      }
    ]
  }'

# å“åº”ï¼š
# {
#   "success": true,
#   "kb_id": "abc123",
#   "total_chunks": 3,
#   ...
# }
```

#### 2. åˆ›å»ºå·¥å…·

```bash
curl -X POST http://127.0.0.1:8000/api/tools \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "demo_user",
    "openapi": {
      "openapi": "3.0.0",
      "info": {"title": "Demo API", "version": "1.0"},
      "paths": {
        "/info": {
          "get": {
            "operationId": "getInfo",
            "summary": "Get information"
          }
        }
      }
    }
  }'

# å“åº”ï¼š
# {
#   "success": true,
#   "tools": [{"tool_id": "demo_user_getInfo", "name": "Get information"}],
#   ...
# }
```

#### 3. å¯¹è¯ï¼ˆå¯ç”¨ RAG å’Œå·¥å…·ï¼‰

```bash
curl -X POST http://127.0.0.1:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½?",
    "model_id": "qwen3-max",
    "session_id": "demo_session",
    "knowledge_bases": ["abc123"],
    "tools": ["demo_user_getInfo"]
  }' \
  --no-buffer

# æµå¼å“åº”ç¤ºä¾‹ï¼š
# data: {"content": "äººå·¥æ™ºèƒ½", "done": false}
# data: {"content": "æ˜¯ä¸€é—¨", "done": false}
# ...
# data: [DONE]
```

#### 4. æŸ¥è¯¢çŸ¥è¯†åº“

```bash
curl -X POST http://127.0.0.1:8000/api/knowledge-bases/query \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "demo_user",
    "query_text": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½?",
    "similarity_threshold": 0.5
  }'

# å“åº”ï¼š
# {
#   "success": true,
#   "count": 1,
#   "results": [
#     {
#       "id": "chunk_1",
#       "text": "äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯...",
#       "similarity": 0.85
#     }
#   ]
# }
```

---

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: FastAPI 0.100+
- **æœåŠ¡å™¨**: Uvicorn
- **å‘é‡æ•°æ®åº“**: Milvus 2.0+
- **LLM**: é€šè¿‡ `model_registry` æ”¯æŒå¤šä¸ªæ¨¡å‹
- **åµŒå…¥æ¨¡å‹**: HuggingFace (e5-base-v2 / all-MiniLM-L6-v2)

---

## è”ç³»ä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

**API ç‰ˆæœ¬**: 2.0.0  
**æœ€åæ›´æ–°**: 2025-12-06
